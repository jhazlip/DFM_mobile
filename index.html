<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		
		
		<link rel="stylesheet" type="text/css" media="all" href="css/style.css">										<!-- dfm_mobile css -->
		
		<script type="text/javascript" src="js/dfm_mobile.js"></script>
		<script src="js/JSXCompressor/jsxcompressor.min.js" type="text/javascript"></script>		<!-- uncompresses json - wont need once NGPS feed done -->
		<script src="http://sandbox.dailyme.com/rmv2/js/recommender.js"></script>										<!-- newstogram -->
		
		<script>
		//content:"";
			document.addEventListener('DOMContentLoaded', function (e) { pageloaded(); }, false);
			var xtesting = 0;
			var xInterface;
			
			var xFeedList = new Array();			//property list of all sections and their feeds
			var activeSection 	= 0;				//the current section number (in xFeedList array) - pointer
			var StoryList = new Array();			//array with all current section stories
			var activeStory		= 0;				//the current story   number (in StoryList array) - pointer DO WE NEED????
			var StoryContent = new Array();			//array with all current stories content
			var propertyTitle = '';
			var propertySplashImage = '';
			var backgroundsplash = '';
			var AppleAppID;
			var topDomain;
			
			var adunit = '/8013/digital.first.media.test.site/Mobile';		//this will probably need to be moved to property.js
			
			
			function get_top_domain(){
				var i,h,
				weird_cookie='weird_get_top_level_domain=cookie',
				hostname = document.location.hostname.split('.');
				for(i=hostname.length-1; i>=0; i--) {
					h = hostname.slice(i).join('.');
					document.cookie = weird_cookie + ';domain=.' + h + ';';
					if(document.cookie.indexOf(weird_cookie)>-1){
						document.cookie = weird_cookie.split('=')[0] + '=;domain=.' + h + ';expires=Thu, 01 Jan 1970 00:00:01 GMT;';
						return h;
					}
				}
			}
			
			
			function pageloaded() {
				//-------everything has loaded, now we need to get property specific js and css before we do anything
				//			yeah not truly efficient, this process can be cleaned up i think for speed but for now, it works
				
				//http://delivery.digitalfirstmedia.com/ConvergencePublisher/?format=json&uri=http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml&paramname=site&param=Denver+Post
				//---for testing loading of external js along with code at bottom of universal.js
				//fetchExternalJSON('http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml');
				//return 0;
				//setTimeout(function() { fetchExternalJSON('http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml'); }, 4000);
				
				
				//---------------------------------------------load property specific external files
				topDomain = get_top_domain();
				//if ( (topDomain == 'localhost') || (topDomain == 'ca1media.mobi') ) topDomain = 'denverpost.com';	//added only for dev, delete before live	//elpasotimes	//denverpost
				topDomain = 'denverpost.com';

				//js
				var url = 'props/'+ topDomain +'/prop.js';
				var script = document.createElement('script');script.setAttribute('src', url);script.setAttribute('id', 'propJS');script.setAttribute('type', 'text/javascript');
				document.getElementsByTagName('head')[0].appendChild(script);
				script.onload = script.onreadystatechange = function() {
					showInterface();
				};

				//css
				var url = 'props/'+ topDomain +'/prop.css';
				var fileref=document.createElement("link");fileref.setAttribute("rel", "stylesheet");fileref.setAttribute("type", "text/css");fileref.setAttribute("href", url)
				if (typeof fileref!="undefined") document.getElementsByTagName("head")[0].appendChild(fileref);
				//---------------------------------------------load property specific external files (end)
			}
			
			function showInterface() {
				//xInterface = new Interface( 'test', {transition: 'fade'});
				xInterface = new Interface( '' );	//this shows nothing but initiates the class

				//once interface is loaded we:
				//	1. load local content
				loadPropertyData();			//eventually once this is loading external content, it will need other things to wait until it is done
				
				//	2. build the sections menu window
				renderSectionsWindow();
				
				//prepareAds();

				//-----------------------------------------------------launch environment
				preloadimages([ 'props/'+ topDomain +'/'+ propertySplashImage ]).done(function(images){
					//when images are done loading:
					
					//-----------------show splash!
					var xString = '<div class="content" ><div class="splash" style="background-image:url(props/'+ topDomain +'/'+ propertySplashImage +');background-color:#'+ backgroundsplash +';"></div></div>'
					document.getElementById( 'splash' ).innerHTML = xString;
					setTimeout(function() { xInterface.showWindow( 'splash', {transition: 'fade'} ); }, 100);
					
					//-----------------set home logo on section front
					//document.getElementById( 'home_logo' ).innerHTML = '<img src="props/'+ topDomain +'/dpflag.svg" width="200" alt="Denver Logo" style="margin-top:5px;margin-left:-5px;"/>';
					ChangeStyleSheet('.flag', 'background', "url('../props/"+ topDomain +"/flag.svg') no-repeat 50%", 0);
					//background: url('assets/dpflag.svg') no-repeat 50%;
					
					//-----------------load sections
					setTimeout(function() { loadNewSection(); }, 1500);
					
					//alert(images.length) //alerts 3//alert(images[0].src+" "+images[0].width) //alerts '1.gif 220'
				});
				//http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml
				
				//----------------------add the app checker for iOS (should be moved to dfm_mobile and only run if iOS) 
				//<meta name="apple-itunes-app" content="app-id=375264133">
				var viewPortTag=document.createElement('meta');
				//viewPortTag.id="viewport";
				viewPortTag.name = "apple-itunes-app";
				viewPortTag.content = "app-id="+ AppleAppID;		//375264133
				document.getElementsByTagName('head')[0].appendChild(viewPortTag);
				//----------------------add the app checker for iOS (should be moved to dfm_mobile and only run if iOS) (END)
				
				
			}
			//xInterface.removeLoaderInWindow('home');//xInterface.putLoaderInWindow( 'home' );//
			
			
		</script>
		
		<!-- 
					how to set page title. Its important for SEO to have it the way we want it load from BACKEND...
						so php might need to be used afterall
		-->
		<title>Colorado Breaking News, Sports, Weather, Traffic - The Denver Post</title>
		
		<!-- 
		<script src="js/iscroll.js" type="text/javascript"></script>
		-->
		<script src="js/universal.js" type="text/javascript"></script>
	</head>
<body>

<div id="dfm_mobile" >
	
	<div id="splash" >
		<div class="content" >
			<div class="splash"  style=""></div>
		</div>
	</div><!-- /splash -->
	
	<div id="home" >
		<div class="toolbar darkblue">
			<!-- ALL buttons first -->
			<div class="sm_but_icon sections" onclick="xInterface.showWindow( 'sections_window', { transition: 'slideRight', overlay:1 });">
				<span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
			</div>
			<div class="sm_but_icon settings right" onclick="xInterface.showWindow( 'settings_window', { transition: 'fade', overlay:1 });"></div>
			
			<!-- then add title -->
			<h4 class="flag"></h4>
		</div>
		<div class="content belowtoolbar " style="background-color:#333;">
			<div id="home_section_list" class="scroller full custom"></div>
		</div>
	</div><!-- /home -->
	
	
	<div id="story_window" >
		<div class="content " style="background-color:#FFF;">
			<div id="story_container" class="scroller "></div>
		</div>
	</div><!-- /story_window -->
	
	<div id="gallery_window" >
		<div class="content " style="background-color:#000;">
			<div id="story_container" class="scroller "></div>
		</div>
	</div><!-- /gallery_window -->
	
	
	<div id="share_window">
		<div class="content alertwindow overlay" style="">
			<div class="close" onclick="xInterface.closeActiveWindow();"><img src="css/close_pop.png" class="btn_close" title="Close Window" style="float: right;margin: -10px -10px 0 0;" /></div>
			<div style="position:absolute;top:20px;left:20px;right:20px;margin:auto;text-align:center;border:1px solid #333;">
				<div style="position:relative;margin:10px;width:200px;display:inline-block;"  ontouchstart="xActiveTouch = 1;" ontouchmove="xActiveTouch = 0;" onclick="event.returnValue=false;if (xActiveTouch) { alert('234'); }">
					<div class="list_image_title" style="margin:5px 0px 0px 0px;width:100%;color:#333;">Sharing alert window will contain buttons for social sharing sites such as Facebook and twitter.</div>
				</div>
			</div>
		</div>
	</div><!-- /share_window -->
	
	<div id="sections_window" style="width:300px;">
			<div class="toolbar invisible" >
				<!-- ALL buttons first -->
				<div class="sm_but_icon sections active"  onclick="xInterface.closeActiveWindow();"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></div>
				<!-- then add title -->
				<h4 class="flag">The Denver Post</h4>
			</div>
			<div class="content belowtoolbar black overlay" style="">
				<div id="sections_container" class="scroller full dark" style="border-right:1px solid #000;"></div>
			</div>

	</div><!-- /sections_window -->
	
	<div id="settings_window">
		<div class="content alertwindow overlay" style="">
			<div class="close" onclick="xInterface.closeActiveWindow();"><img src="css/close_pop.png" class="btn_close" title="Close Window" style="float: right;margin: -10px -10px 0 0;" /></div>
			<div style="position:absolute;top:20px;left:20px;right:20px;margin:auto;text-align:center;border:1px solid #333;">
				<div style="position:relative;margin:10px;width:200px;display:inline-block;"  ontouchstart="xActiveTouch = 1;" ontouchmove="xActiveTouch = 0;" onclick="event.returnValue=false;if (xActiveTouch) { alert('234'); }">
					<div class="list_image_title" style="margin:5px 0px 0px 0px;width:100%;color:#333;">Settings window will contain features such as 'View Desktop Version', change article text size, etc.</div>
				</div>
			</div>
		</div>
	</div><!-- /settings_window -->
	
	
</div><!-- /dfm_mobile -->

</body>
</html>
