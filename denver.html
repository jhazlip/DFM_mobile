<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		
		<link rel="stylesheet" type="text/css" media="all" href="css/styles.css">
		<script type="text/javascript" src="mobie.js"></script>
		<script src="JSXCompressor/jsxcompressor.min.js" type="text/javascript"></script>
		<script src="http://sandbox.dailyme.com/rmv2/js/recommender.js"></script>	
		
		<style type="text/css">
			.story_headline {
				font: bold 20px/24px Helvetica, Sans-serif;
				color:#464646;margin:10px 0px 6px 0px;
			}
			.story_pubdate, .story_update {
				font: normal 14px/14px "Times New Roman",Georgia,Serif;
				color:#464646;margin:2px 0px 6px 0px;
			}
			
			.story_content {
				font: normal 16px/20px Helvetica, Sans-serif;
				color:#464646;margin:2px 0px 25px 0px;padding-bottom:10px;
			}
			.story_breadCrumbs {
				font: normal 14px/24px Helvetica, Sans-serif;
				color:#464646;margin:10px 0px 6px 0px;
			}
			.story_author {
				font: normal 16px/22px Helvetica, Sans-serif;
				color:#464646;margin:10px 0px 6px 0px;font-style:italic;
			}
			
			.scroller.full.custom li {
				height:52px;position:relative;background-color:green;
			}
			
			.story_title {
				overflow:hidden;text-overflow: ellipsis;white-space: nowrap;
				width:90%;margin-right:30px;
			}
			
			.scroller.full.custom li:after {
				position:absolute;top:20px;right:4px;color:#464646;
			}
			
			
			.scroller.custom .list_header {
				color:#FFF;
			}
			
			.toolbar.darkdarkblue {
				background-image: -webkit-gradient(linear, 50% 0, 50% 100%, from(#11598C), color-stop(0.03, #154e77), to(#113752));
				background: -moz-linear-gradient(top, #11598C 0%, #154e77 50%, #154e77 51%, #113752 100%); /* FF3.6+ */
			}
			
			.toolbar.movable {
				position:static;height:60px;background-color:none;background:none;
				background-image: none;box-shadow: none;
				border: 0px;
			}
			
			.fakelink {
				text-decoration:underline;
			}
		</style>
		
		
		<script>
		//content:"";
			document.addEventListener('DOMContentLoaded', function (e) { pageloaded(); }, false);
			var xtesting = 0;
			var xInterface;
			
			var xFeedList = new Array();			//property list of all sections and their feeds
			var activeSection 	= 0;				//the current section number (in xFeedList array) - pointer
			var StoryList = new Array();			//array with all current section stories
			var activeStory		= 0;				//the current story   number (in StoryList array) - pointer
			var propertyTitle = '';
			var propertyImage = '';
			var backgroundsplash = '';
			
			/*
			//notes 
			Chris there are some errors. Shows up on iphone and android phones... havent tried android tablet
			go to many stories quickly. eventually locks up screen, cant do anything.
			Just did this on android mobile and now i cant get it to reload and show anythign
			
			Console showed this:
			I/browser (25561): Console: ------mobie: closeActiveWindow ANIMATION DONE http://192.168.1.6/tests/mobie/mobie.js:842
			I/browser (25561): Console: ------mobie: showWindow------: story_window http://192.168.1.6/tests/mobie/mobie.js:689
			I/browser (25561): Console: ------mobie: resizeScrollers------ http://192.168.1.6/tests/mobie/mobie.js:216
			then lock up
			
			Need to try it on android tablet in chrome, see if i can console thorugh it and see whats up.
			Could be tied to resizescrollers when we might be doing somethign else
			
			*/
			
			function pageloaded() {
				//xInterface = new Interface( 'test', {transition: 'fade'});
				xInterface = new Interface( '' );	//this shows nothing but initiates the class
				
				//once interface is loaded we:
				//	1. load local content
				loadPropertyData();			//eventually once this is loading external content, it will need other things to wait until it is done
				
				//	2. build the sections menu window
				renderSectionsWindow();
				
				//-----------------------------------------------------launch environment
				preloadimages([ propertyImage ]).done(function(images){
					//when images are done loading:
					xInterface.showWindow( 'splash', {transition: 'fade'} );
					setTimeout(function() { loadNewSection(); }, 1500);
					
					//alert(images.length) //alerts 3//alert(images[0].src+" "+images[0].width) //alerts '1.gif 220'
				});
				//http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml
			}
			//xInterface.removeLoaderInWindow('home');//xInterface.putLoaderInWindow( 'home' );//
			
			function addAdToDiv( xSize, xDiv ) {
				//alert( xSize+":"+ xDiv );
				var xString;
				if ( xSize == '300x50') {
					xString = '<img src="ad_300x50.gif" width="300" height="50" style="display:block;margin:auto;" />';
				} else if ( xSize == '300x250') {
					xString = '<img src="ad_300x250.gif" width="300" height="250" style="display:block;margin:auto;" />';
				} else {
					alert( 'wrong ad size: '+ xSize );
					return;
				}
				
				document.getElementById( xDiv ).innerHTML = xString;
			}
			
			function clickNewSection( xnum ) {
				//called when a user clicks a new section in the sections window
				xInterface.putLoaderInWindow( 'home' );
				
				xInterface.closeActiveWindow();
				//alert( xnum);
				activeSection = xnum;
				setTimeout(function() { loadNewSection(); }, 10);
			}
			
			function loadNewSection() {
				console.debug( 'loadNewSection: '+ xFeedList[activeSection].title);
				xURL = 'denverfeed.php?x='+ xFeedList[activeSection].url;
				request(
					xURL, null,function() {
						if ( this.readyState == 4) {
							var xdata = this.responseText;
							if ( xdata == '' ) {
								//alert( 'Error loading URL!' );
							} else {
								//ok we have loaded the luck data, now we convert they JSON into a javascript array and then do something with it
								//alert( xdata.length );	//before decompression
								xdata = JXG.decompress(xdata);
								//alert( xdata.length );	//after decompression
								//alert( xdata );
								StoryList = eval ("(" + xdata + ")");
								DrawStoryList();
								setTimeout(function() { xInterface.removeLoaderInWindow('home'); }, 500);
							}
						}
					}, 'GET'
				);
			}
			
			function DrawStoryList() {
				console.debug( 'DrawStoryList: ');
				var xString = '';//<div class="scroller">';
				xString +=	'<div class="list_header " style="">'+ xFeedList[activeSection].title +'</div>';
				xString +=	'<ul class="list Xul">';
				for (var i=0; i<StoryList.length;i++) {
					xString +=	'	<li class="Xli" onclick="viewStory('+ i +');" style="">';
					xString +=	'		<div class="story_title">'+ StoryList[i].title +'</div>';
					xString +=	'		<div class="" style="font: bold 12px/12px Helvetica, Sans-serif;color:#464646;margin-top:-4px;width:100%;">'+ StoryList[i].pubDate +'</div>';
					xString +=	'	</li>';
				}
				
				xString +=	'</ul>';
				//xString +=	'</div>';
				xString +=	'	<div style="background-color:none;"><img src="dfm_logo.png" style="max-width:100px;display:block;margin:auto;margin-top:12px;margin-bottom:5px;" />';
				
				var d = new Date().getUTCFullYear();
				xString +=	'		<div style="display: block;margin: 0px auto;width:90%;color:white;font-family:Arial;font-size:10px;color:#FFF;text-align:center;line-height:100%;padding-bottom:20px;">';
				xString +=	'		All contents Â© '+ d +' Digital First Media or other copyright holders. All rights reserved. This material may not be published, broadcast, rewritten or redistributed for any commercial purpose.</div>';
				
				xString +=	'</div>';
				
				document.getElementById( 'home_section_list' ).innerHTML = xString;
				
				if ( xInterface.doesWindowExist( 'home' ) ) {
					console.debug( 'it exists!: ');
					setTimeout(function() { xInterface.resizeScrollers(); }, 10);
					//setTimeout(function() { xInterface.refreshWindow('home'); }, 10);
				} else {
					console.debug( 'create new: ');
					setTimeout(function() { xInterface.showWindow( 'home', {transition: 'fade'} ); }, 1000);
				}
				
			}
			
			function dumpProps(obj, parent) {
			   // Go through all the properties of the passed-in object
			   for (var i in obj) {
			      // if a parent (2nd parameter) was passed in, then use that to
			      // build the message. Message includes i (the object's property name)
			      // then the object's property value on a new line
			      if (parent) { var msg = parent + "." + i + "\n" + obj[i]; } else { var msg = i + "\n" + obj[i]; }
			      // Display the message. If the user clicks "OK", then continue. If they
			      // click "CANCEL" then quit this level of recursion
			      //if (!confirm(msg)) { return; }
					console.debug( msg );
			      // If this property (i) is an object, then recursively process the object
			      if (typeof obj[i] == "object") {
			         if (parent) { dumpProps(obj[i], parent + "." + i); } else { dumpProps(obj[i], i); }
			      }
			   }
			}
			
			
			
			function viewStory(xnum) {
				if ( xInterface.allowUserEvent() ) {
					activeStory = xnum;

					//document.getElementById( 'story_title' ).innerHTML = xFeedList[activeSection].title;

					//----------------create story page!!!
					/*
					denver.html:135@attributes.url
					denver.html:135@attributes.fileSize
					denver.html:135@attributes.type
					*/

					//dumpProps( StoryList[ activeStory ].media );
					
					//----------------------------------------------build story view div string
					var xString = '';
					var xURL = 0;
					if ( StoryList[ activeStory ].media['@attributes'] ) {
						xURL = StoryList[ activeStory ].media['@attributes'].url;
					}
					
					//xString += '<img src="ad_300x50.gif" width="300" height="50" style="display:block;margin:auto;" />';
					//xString += '<div class="story_top_ad"><script> alert(1); <\/script></div>';	//did not work
					
					/*
					xString += '<div class="toolbar movable">';
					xString += '	<div class="sm_but_icon leftarrowb left"  onclick="xInterface.closeActiveWindow();"></div>';
					xString += '	<div class="sm_but_icon shareb " onclick="xInterface.showWindow( \'share_window\', { transition: \'fade\', overlay:1 });"></div>';
					xString += '</div>';
					*/
					
					xString += '<div class="story_breadCrumbs"  style="color:#9e9e9e;font-weight:bold;" onclick="xInterface.closeActiveWindow();"> View Section Front</div>';
					
					xString += '<div id="story_ad_top" style="height:50px;"></div>';
					xString += '<div class="story_breadCrumbs"><span class="fakelink" onclick="clickNewSection(1);">Home</span> / <span class="fakelink" onclick="clickNewSection(1);">News</span> / Story</div>';
					
					if ( xURL ) xString += '<img src="'+ xURL +'" style="width:100%;display:block;margin:auto;" />';
                    
					
					xString += '<div class="story_headline">'+StoryList[ activeStory ].title +'</div>';
					xString += '<div class="story_pubdate">PUBLISHED '+ StoryList[ activeStory ].pubDate.toUpperCase() +'</div>';
					xString += '<div class="story_update">UPDATED '+StoryList[ activeStory ].lastUpdate[0].toUpperCase() +'</div>';
					xString += '<div class="story_author">By Kirk Mitchell, The Denver Post</div>';
					xString += '<div class="story_content">'+StoryList[ activeStory ].description +'</div>';
					
					xString += '<div id="story_related_content" style="margin-bottom:40px;">';
						xString += '<div class="story_author">Related stories:</div>';
					
						for (var i=0; i<3;i++) {
							xString += '<li onclick="openStoryFromStory('+i+');">'+ StoryList[ i ].title +'</li>';
						}
					xString += '</div>';
					
					xString += '<div id="story_ad_bottom" style="height:50px;"></div>';
					
					xString += '<div class="ng-recommender" id="ng-recommender" style="height:700px;width:100%;display:block;padding:0px;margin-left:-10px;"></div>';
					
					//----------------------------------------------build story view div string (end)
					
					document.getElementById( 'story_container' ).innerHTML = xString;
					
					//---now that the divs are there, we need to dynamically add the ads
					setTimeout(function() { 
						addAdToDiv( '300x50', 'story_ad_top' );
						addAdToDiv( '300x50', 'story_ad_bottom' );
						newsToGram();
					}, 1000);
					
					if ( xURL ) {
						//-------there is an image, so create listener to resize 'story_window' after image is loaded (since we dont know its size ahead of time)
						xInterface.putLoaderInWindow( 'story_window' );
						preloadimages([ xURL ]).done(function(images){
							console.debug('story image loaded' );
							//when images are done loading:
							xInterface.removeLoaderInWindow('story_window');
							setTimeout(function() { xInterface.resizeScrollers(); }, 100);
							//xInterface.resizeScrollers();
							/*
							setTimeout(function() { 
								xInterface.removeLoaderInWindow('story_window');
								xInterface.resizeScrollers();
							}, 100);
							*/
						})

					} else {
						//-------no images, just a story
						setTimeout(function() { xInterface.resizeScrollers(); }, 10);

					}


					xInterface.showWindow( 'story_window', {
						onCloseDone: function () {
							//alert('onCloseDone function called!');
							console.debug('------mobie: onCloseDone for story_window' );
							this.WindowScrollerArray[0].scrollTo(0,0,0);
						}
					} );

					//setTimeout(function() { xInterface.resizeScrollers(); }, 10);

					/*
					if ( xInterface.doesWindowExist( 'story_window' ) ) {
						console.debug( 'it exists!: ');


					} else {
						console.debug( 'create new: ');

					}
					*/


					/*
					<div class="content belowtoolbar " style="background: url( 'http://ca1media.mobi/content/tools/images/paper_pattern.gif');color:#333;">
						<div id="story_container" class="scroller "></div>
					</div>
					<div id="story_container" class="content belowtoolbar " style="background: url( 'http://ca1media.mobi/content/tools/images/paper_pattern.gif');color:#333;"></div>
					*/
				}
			}
			
			function newsToGram() {
				var ngRec = new Newstogram.recommender({
					adPosition: 'right',
					apiKey: 'dailymedemo',
					source:'dailyme',
					filter:'2',
					headlinesRotation:true,
					customParams:'source=dailyme',
					cssUrl: 'http://sandbox.dailyme.com/rmv2/css/recommender.css',
					limit: 6,
					maxWidth: 400
					});
				ngRec.init();
			}
			
			function openStoryFromStory(xnum) {
				//user is reading a story and clicks to view another story
				//console.debug('------mobie: onCloseDone for story_window' );
				var xBackWindowId = xInterface.currentWindow.backToWindowObject.id;
				
				if ( xBackWindowId ) {
					xInterface.putLoaderInWindow( xBackWindowId );
					xInterface.closeActiveWindow();
					setTimeout(function() { 
						xInterface.currentWindow.WindowScrollerArray[0].scrollTo(0,0,0);
						viewStory(xnum);
						setTimeout(function() {
							xInterface.removeLoaderInWindow(xBackWindowId);		//should this eventually be automatically removed in viewStory ?
						}, 1000);
						
					}, 1000);
				} else {
					
				}
				
				
				
				//xInterface.closeActiveWindow();
				
				
			}
			
			function loadPropertyData() {
				//----Eventually I will pull each properties data from the server
				//		So, for example, this property (denver) would call to server passing unique property id
				//		The server would then send back a JSON array with all the properties data,
				//		including property title, activeSection and an array of all the sections and their corresponding feeds (below)
				
				
				
				xFeedList = new Array(
						{ 'title' : 'Business', 'url' : 'http://extras.denverpost.com/media/MRSS/Business_230614.xml' },
						{ 'title' : 'Breaking News', 'url' : 'http://extras.denverpost.com/media/MRSS/Breaking_News_230605.xml' },
						{ 'title' : 'Broncos', 'url' : 'http://extras.denverpost.com/media/MRSS/Broncos_230613.xml' },
						{ 'title' : 'Sports', 'url' : 'http://extras.denverpost.com/media/MRSS/Breaking_Sports_247701.xml' },
						{ 'title' : 'Entertainment', 'url' : 'http://extras.denverpost.com/media/MRSS/Entertainment_230611.xml' },
						{ 'title' : 'Featured', 'url' : 'http://extras.denverpost.com/media/mRSS/Featured_237705.xml' },
						{ 'title' : 'Nuggets', 'url' : 'http://extras.denverpost.com/media/MRSS/Nuggets_230616.xml' },
						{ 'title' : 'Nation / World', 'url' : 'http://extras.denverpost.com/media/MRSS/Nation_World_230615.xml' },
						{ 'title' : 'Lifestyle', 'url' : 'http://extras.denverpost.com/media/MRSS/Lifestyle_230610.xml' },
						{ 'title' : 'Opinion', 'url' : 'http://extras.denverpost.com/media/MRSS/Opinion_230609.xml' },
						{ 'title' : 'Politics', 'url' : 'http://extras.denverpost.com/media/MRSS/Politics_230620.xml' },
						{ 'title' : 'Preps', 'url' : 'http://extras.denverpost.com/media/MRSS/Prep_Main_245424.xml' },
						{ 'title' : 'Rockies', 'url' : 'http://extras.denverpost.com/media/MRSS/Rockies_230619.xml' }
					);
				
				//alert( xFeedList[0].title );
				//alert( xFeedList[0].url );
				
				propertyTitle = 'The Denver Post';
				activeSection = 1;		//breaking news
				propertyImage = 'denverpostsplash.gif';
				backgroundsplash = '0079c2';				//el paso 'f2f8fe'
			}
			
			function renderSectionsWindow() {
				console.debug( 'renderSectionsWindow: ');
				var xString = '<div class="list_header ">'+ propertyTitle +':</div>';
				xString += '<ul class="list ">';
				for (var i=0; i<xFeedList.length;i++) {
					xString += '<li onclick="clickNewSection('+i+');">'+ xFeedList[i].title +'</li>';
				}
				xString +=	'</ul>';
				xString +=	'</div>';
				
				document.getElementById( 'sections_container' ).innerHTML = xString;
			}
			
		</script>
		
		<title>Denver Post</title>
		<script src="iscroll.js" type="text/javascript"></script>
		
	</head>
<body>

<div id="mobie" >
	
	<div id="splash" >
		<div class="content" >
			<div style="position:absolute;background-color:none;width:100%;height:100%;top:0%;background-image:url(denverpostsplash.gif);background-size: contain;background-repeat:no-repeat;background-position:center;background-color:#0079c2;"></div>
		</div>
	</div><!-- /splash -->
	
	
	<div id="home" >
		<div class="toolbar darkblue">
			<!-- ALL buttons first -->
			<div class="sm_but_icon section_sm_w left" onclick="xInterface.showWindow( 'sections_window', { transition: 'slideRight', overlay:1 });"></div>
			<div class="sm_but_icon settings_sm_w " onclick="xInterface.showWindow( 'settings_window', { transition: 'fade', overlay:1 });"></div>
			
			<!-- then add title -->
			<h1>The Denver Post</h1>
		</div>
		<div class="content belowtoolbar " style="background-color:#333;">
			<div id="home_section_list" class="scroller full custom"></div>
		</div>
	</div><!-- /home -->
	
	
	
	<div id="story_window" >
		<div class="content " style="background-color:#FFF;">
			
			<div id="story_container" class="scroller "></div>
		</div>
	</div><!-- /story_window -->
	
	<div id="share_window">
		<div class="content alertwindow overlay" style="">
			<div class="close" onclick="xInterface.closeActiveWindow();"><img src="css/close_pop.png" class="btn_close" title="Close Window" style="float: right;margin: -10px -10px 0 0;" /></div>
			<div style="position:absolute;top:20px;left:20px;right:20px;margin:auto;text-align:center;border:1px solid #333;">
				<div style="position:relative;margin:10px;width:200px;display:inline-block;"  ontouchstart="xActiveTouch = 1;" ontouchmove="xActiveTouch = 0;" onclick="event.returnValue=false;if (xActiveTouch) { alert('234'); }">
					<div class="list_image_title" style="margin:5px 0px 0px 0px;width:100%;color:#333;">Sharing alert window will contain buttons for social sharing sites such as Facebook and twitter.</div>
				</div>
			</div>
		</div>
	</div><!-- /share_window -->
	
	<div id="sections_window" style="width:300px;border-right:1px solid #000;">
			<div class="toolbar darkdarkblue">
				<!-- ALL buttons first -->
				<div class="sm_but_icon leftarroww left"  onclick="xInterface.closeActiveWindow();"></div>
				<div class="sm_but_icon settingsw invisible"></div><!-- center title by having same amount of buttons on each side. This one is on right (default) -->
				<!-- then add title -->
				<h1>SECTIONS</h1>
			</div>

			<div class="content belowtoolbar black overlay" style="">
				<div id="sections_container" class="scroller full dark"></div>
			</div>

	</div><!-- /sections_window -->
	
	<div id="settings_window">
		<div class="content alertwindow overlay" style="">
			<div class="close" onclick="xInterface.closeActiveWindow();"><img src="css/close_pop.png" class="btn_close" title="Close Window" style="float: right;margin: -10px -10px 0 0;" /></div>
			<div style="position:absolute;top:20px;left:20px;right:20px;margin:auto;text-align:center;border:1px solid #333;">
				<div style="position:relative;margin:10px;width:200px;display:inline-block;"  ontouchstart="xActiveTouch = 1;" ontouchmove="xActiveTouch = 0;" onclick="event.returnValue=false;if (xActiveTouch) { alert('234'); }">
					<div class="list_image_title" style="margin:5px 0px 0px 0px;width:100%;color:#333;">Settings window will contain features such as 'View Desktop Version', change article text size, etc.</div>
				</div>
			</div>
		</div>
	</div><!-- /settings_window -->
	
</div><!-- /mobie -->

</body>
</html>
